'use strict';

var freemem = require('os').freemem;
var codec = require('../codec');

var id = Math.random();
var recv = 0;

var sub = require('redis').createClient()
	.on('ready', function() {
		this.subscribe('timeline');
	})
	.on('Message', function(channel, Message) {
		var self = this;
		if (Message) {
			Message = codec.decode(Message);
			++recv;
		}
	});

setInterval(function() {
	console.error('id', id, 'received', recv, 'free', freemem());
}, 2000);
